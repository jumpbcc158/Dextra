<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Canva Switcher (Lite v2)</title>
  <style>
    html, body, iframe { height:100%; width:100%; margin:0; border:0; padding:0; background:#fff; }
  </style>
</head>
<body>
  <iframe id="cv" src="https://www.canva.com/design/DAGq31qQuv0/bWCRwDmebc_YtTsuj6VMiA/view?embed#1" allowfullscreen loading="lazy"></iframe>

  <script>
    (function() {
      const MAX = 50;
      const base = "https://www.canva.com/design/DAGq31qQuv0/bWCRwDmebc_YtTsuj6VMiA/view?embed";
      const iframe = document.getElementById('cv');

      function clamp(n) { n = parseInt(n, 10); return (isNaN(n) ? 1 : Math.max(1, Math.min(MAX, n))); }

      function getParamFrom(url, name) {
        try {
          const q = new URL(url).searchParams.get(name);
          return q ? clamp(q) : null;
        } catch (e) { return null; }
      }

      function getHashNumber(hash) {
        if (!hash) return null;
        const m = hash.match(/#(\d+)/);
        return m ? clamp(m[1]) : null;
      }

      function resolvePage() {
        // Priority: local ?page -> parent ?cv -> parent hash -> top ?cv -> top hash -> default 1
        const local = getParamFrom(window.location.href, 'page');
        if (local) return local;

        try {
          const purl = window.parent && window.parent.location ? window.parent.location.href : null;
          if (purl) {
            const fromCv = getParamFrom(purl, 'cv');
            if (fromCv) return fromCv;
            const fromHash = getHashNumber(window.parent.location.hash);
            if (fromHash) return fromHash;
          }
        } catch (e) { /* cross-origin parent */ }

        try {
          const turl = window.top && window.top.location ? window.top.location.href : null;
          if (turl) {
            const fromCvTop = getParamFrom(turl, 'cv');
            if (fromCvTop) return fromCvTop;
            const fromHashTop = getHashNumber(window.top.location.hash);
            if (fromHashTop) return fromHashTop;
          }
        } catch (e) { /* cross-origin top */ }

        return 1;
      }

      function setPage(n) {
        iframe.src = base + '#' + clamp(n);
      }

      setPage(resolvePage());

      try {
        window.parent.addEventListener('hashchange', function() {
          const h = getHashNumber(window.parent.location.hash);
          if (h) setPage(h);
        });
      } catch (e) { /* ignore if cross-origin */ }
    })();
  </script>
</body>
</html>
